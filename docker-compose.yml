services:
  nats:
    image: nats:latest
    container_name: nats-server
    command: ["-config", "/etc/nats/nats.conf"]
    ports:
      - "4222:4222"
      - "8222:8222"
    environment:
      - "SYSTEM_ACCOUNT=AALQCF4M7HNUZXTTUJYH4LYH2KR7XYNOEGACORLW7AQNUVOI46EMWKHE"
      - "NATS_ENCRYPTION_KEY=17556952fcfc80b5661c7b793a7472dfb6c06d493410206c7776d214ed836101"
      - "DATA_CONSUMER_USERNAME=dataconsumer"
      - "DATA_CONSUMER_PWD=dataconsumer"
      - "GATEWAY1_USERNAME=gateway1"
      - "GATEWAY1_PWD=gateway1"
      - "GATEWAY2_USERNAME=gateway2"
      - "GATEWAY2_PWD=gateway2"
    volumes:
      - ./nats-jetstream/nats.conf:/etc/nats/nats.conf
      - ./nats-jetstream/jetstream-data:/etc/nats/data
      - ./nats-jetstream/certs:/etc/nats/certs
      - ./nats-jetstream/jwt-accounts:/etc/nats/jwt-accounts
    networks:
      - nats-net
  timescaledb:
    image: timescale/timescaledb:latest-pg16
    container_name: timescaledb
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_USER=admin
      - POSTGRES_PASSWORD=admin
      - POSTGRES_DB=sensors_db
    volumes:
      - ./database/timescale-data:/var/lib/postgresql/data
    networks:
      - nats-net
      
networks:
  nats-net:
    driver: bridge