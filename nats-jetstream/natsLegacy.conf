port: 4222

http_port: 8222

jetstream {
	store_dir: /etc/nats/data
    cipher: "aes"
    key: $NATS_ENCRYPTION_KEY
    limits {
        max_ack_pending: 10000
        duplicate_window: 600s
    }
}

tls {
    cert_file: "/etc/nats/certs/server.pem"
    key_file:  "/etc/nats/certs/server.key"
    ca_file:   "/etc/nats/certs/ca.pem"
}
# ca.key: chiave PRIVATO della tua CA(in questo caso noi)
# ca.pem: certificato PUBBLICO della CA che garantisce se un certificato Ã¨ stato veramente firmato dalla CA
# server.key: chiave SEGRETA serve per decifrare i messaggi
# server.pem: certificato finale del server firmato dalla CA


accounts {
    # I data consumer hanno le stesse credenziali
    DATA_CONSUMER = {
        publish = {
            deny: ">" #non possono pubblicare su nessun subject
        },
        subscribe: {
            allow: "sensors.>" #possono ascoltare solo i dati dei sensori
        },
        allow_responses: false
    }

    #Permessi gateway 1 associato al tenant_1
    GATEWAY_1 = {
        publish = {
            allow: "sensors.tenant_1.>"
        },
        subscribe: {
            deny: ">"
        },
        allow_responses: false
    }

    #Permessi gateway 2 associato al tenant_2
    GATEWAY_2 = {
        publish = {
            allow: "sensors.tenant_2.>"
        },
        subscribe: {
            deny: ">"
        },
        allow_responses: false
    }

    NO_AUTH = {
        publish = {
            deny: ">"
        },
        subscribe: {
            deny: ">"
        },
        allow_responses: false
    }

    noAuth: {
        users: [
            {user: noAuth, permissions: $NO_AUTH}
        ]
    }

    dataConsumer: {
        users: [
            {user: $DATA_CONSUMER_USERNAME, password: $DATA_CONSUMER_PWD, permissions: $DATA_CONSUMER}
        ]
    }

    tenant1: {
        users: [
            {user: $GATEWAY1_USERNAME, password: $GATEWAY1_PWD, permissions: $GATEWAY_1}
        ]
    },
    tenant2: {
        users: [
            {user: $GATEWAY2_USERNAME, password: $GATEWAY2_PWD, permissions: $GATEWAY_2}
        ]
    }
}

no_auth_user: noAuth
